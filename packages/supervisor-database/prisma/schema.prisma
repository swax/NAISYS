datasource db {
  provider = "sqlite"
}

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

enum Permission {
  supervisor_admin
  manage_agents
  agent_communication
  manage_models
  manage_variables
}

model User {
  id               Int              @id @default(autoincrement())
  username         String           @unique
  uuid             String           @default("")
  isAgent          Boolean          @default(false) @map("is_agent")
  passwordHash     String           @default("") @map("password_hash")
  sessionTokenHash String?          @map("session_token_hash")
  sessionExpiresAt DateTime?        @map("session_expires_at")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  permissions      UserPermission[] @relation("UserPermissions")
  grantedPermissions UserPermission[] @relation("GrantedByPermissions")

  @@map("users")
}

model UserPermission {
  id         Int        @id @default(autoincrement())
  userId     Int        @map("user_id")
  permission Permission
  grantedAt  DateTime   @default(now()) @map("granted_at")
  grantedBy  Int?       @map("granted_by")
  user       User       @relation("UserPermissions", fields: [userId], references: [id], onDelete: Cascade)
  grantedByUser User?   @relation("GrantedByPermissions", fields: [grantedBy], references: [id])

  @@unique([userId, permission])
  @@map("user_permissions")
}

model SchemaVersion {
  id      Int    @id @default(1)
  version Int
  updated String

  @@map("schema_version")
}
